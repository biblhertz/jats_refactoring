# Scripts to prepare JATS files for inDesign XML import
With the provided `biblio2.py` script and the `htmlbiblio2xml.xslt` stylesheet, you have a comprehensive workflow for converting a BibTeX bibliography to an XML format suitable for InDesign, following an intermediate HTML conversion step (for the bibliography). To coordinate this with your JATS article processing (`article2indesign.py`) and the eventual merging of the article and bibliography into a final document.
With the `combine.py` script, you now have a complete workflow for processing a JATS article, converting a bibliography into XML, and combining both into a single XML document ready for InDesign. This script effectively merges the article and bibliography XML files by appending the bibliography to the `<back>` section of the article XML.

### Automated Workflow

1. **Process the JATS Article**: First, use `article2indesign.py` to transform the JATS XML with the provided XSLT and create an InDesign-ready XML document.

2. **Convert the Bibliography**: Next, run `biblio2.py` to convert the bibliography from BibTeX to XML, applying the necessary transformations.

3. **Merge Article and Bibliography**: Finally, use `combine.py` to merge the XML outputs from the first two steps into a single XML document.


## Single steps:

### Step 1: Process JATS Article
First, use `article2indesign.py` to process the JATS article. This script applies an XSLT transformation to the JATS XML and outputs a minified and transformed XML file ready for InDesign. The existing references are ignored.

``` bash
```

### Step 2: Convert Bibliography
Next, run `biblio2.py` to convert the BibTeX file into an XML format via an intermediate HTML representation. This involves:
- Converting the BibTeX file to HTML using Pandoc with a specified CSL style.
- Applying an XSLT transformation to the HTML to produce the final XML bibliography.

### Step 3: Merge Article and Bibliography
Finally, `combine.py` script helps to merge the XML outputs from Steps 1 and 2. This script will:
- Load the XML file generated by `article2indesign.py`.
- Load the XML bibliography file generated by `biblio2.py`.
- Combine these XML documents into a single XML file that integrates the article content with the bibliography in the desired structure for InDesign.

### Integration Approach
To automate this workflow, you can create a master Python script that sequentially executes these steps. This script would:
1. Call `article2indesign.py` with the appropriate arguments.
2. Call `biblio2.py` with the necessary parameters for the bibliography conversion.
3. Perform the merging of the XML outputs.

### Example Master Script
Here's a simplified outline of what the master script could look like:

```python
import subprocess

# Step 1: Process JATS Article
subprocess.run(['python', 'article2indesign.py', 'path_to_jats.xml', 'jats2idml.xslt'])

# Step 2: Convert Bibliography
subprocess.run(['python', 'biblio2.py', '--bib', 'bibliography.bib', '--output', 'bibliography.html', '--csl', 'style.csl', '--xslt', 'htmlbiblio2xml.xslt'])

# Step 3: Merge Article and Bibliography (Pseudocode)
# This step will depend on how you choose to implement the merging logic.
# You might load both XML files, then use lxml or similar library to combine them.
```


This approach automates the coordination of your scripts, streamlining the process of preparing your JATS articles and bibliographies for InDesign.